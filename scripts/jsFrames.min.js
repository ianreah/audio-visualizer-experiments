(function(h,p){function w(){}function F(a){return a}function H(){return(new Date).getTime()}function M(a,b){return a===b}function S(a,b){return a-b}function J(a){return a.toString()}function y(a){throw a;}function E(){if(this.isDisposed)throw Error(ia);}function N(a,b){return 1===a.length&&Array.isArray(a[b])?a[b]:A.call(a)}function T(a,b){for(var c=Array(a),e=0;e<a;e++)c[e]=b();return c}function z(a,b){this.scheduler=a;this.disposable=b;this.isDisposed=!1}function n(a,b,c,e,j){this.scheduler=a;this.state=
b;this.action=c;this.dueTime=e;this.comparer=j||S;this.disposable=new v}function K(a,b){var c=this;return new r(function(e){var j=0,t=a.length;return c.subscribe(function(c){if(j<t){var g=a[j++],d;try{d=b(c,g)}catch(f){e.onError(f);return}e.onNext(d)}else e.onCompleted()},e.onError.bind(e),e.onCompleted.bind(e))})}var I="object"==typeof exports&&exports&&("object"==typeof global&&global&&global==global.global&&(h=global),exports),q={Internals:{}},ia="Object has been disposed";Function.prototype.bind||
(Function.prototype.bind=function(a){var b=this,c=A.call(arguments,1),e=function(){if(this instanceof e){var j=function(){};j.prototype=b.prototype;var j=new j,t=b.apply(j,c.concat(A.call(arguments)));return Object(t)===t?t:j}return b.apply(a,c.concat(A.call(arguments)))};return e});var A=Array.prototype.slice,Z={}.hasOwnProperty,D=q.Internals.inherits=function(a,b){function c(){this.constructor=a}for(var e in b)"prototype"!==e&&Z.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.super_=
b.prototype;return a},O=q.Internals.addProperties=function(a){for(var b=A.call(arguments,1),c=0,e=b.length;c<e;c++){var j=b[c],t;for(t in j)a[t]=j[t]}},oa=q.Internals.addRef=function(a,b){return new r(function(c){return new g(b.getDisposable(),a.subscribe(c))})};Array.prototype.every||(Array.prototype.every=function(a,b){for(var c=Object(this),e=0,j=c.length>>>0;e<j;e++)if(e in c&&!a.call(b,c[e],e,c))return!1;return!0});Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=j.length>>>
0,e=Array(c),j=Object(this),t=0;t<c;t++)t in j&&e.push(a.call(b,j[t],t,j));return e});Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c=[],e,j=Object(this),t=0,g=j.length>>>0;t<g;t++)e=j[t],t in j&&a.call(b,e,t,j)&&c.push(e);return c});Array.isArray||(Array.isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)});Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=Object(this),c=b.length>>>0;if(0===c)return-1;var e=0;1<arguments.length&&
(e=Number(arguments[1]),e!=e?e=0:0!=e&&(Infinity!=e&&-Infinity!=e)&&(e=(0<e||-1)*Math.floor(Math.abs(e))));if(e>=c)return-1;for(e=0<=e?e:Math.max(c-Math.abs(e),0);e<c;e++)if(e in b&&b[e]===searchElement)return e;return-1});var l=function(a,b){this.id=a;this.value=b};l.prototype.compareTo=function(a){var b=this.value.compareTo(a.value);0===b&&(b=this.id-a.id);return b};var d=function(a){this.items=Array(a);this.length=0},f=d.prototype;f.isHigherPriority=function(a,b){return 0>this.items[a].compareTo(this.items[b])};
f.percolate=function(a){if(!(a>=this.length||0>a)){var b=a-1>>1;if(!(0>b||b===a)&&this.isHigherPriority(a,b)){var c=this.items[a];this.items[a]=this.items[b];this.items[b]=c;this.percolate(b)}}};f.heapify=function(a){a===p&&(a=0);if(!(a>=this.length||0>a)){var b=2*a+1,c=2*a+2,e=a;b<this.length&&this.isHigherPriority(b,e)&&(e=b);c<this.length&&this.isHigherPriority(c,e)&&(e=c);e!==a&&(b=this.items[a],this.items[a]=this.items[e],this.items[e]=b,this.heapify(e))}};f.peek=function(){return this.items[0].value};
f.removeAt=function(a){this.items[a]=this.items[--this.length];delete this.items[this.length];this.heapify()};f.dequeue=function(){var a=this.peek();this.removeAt(0);return a};f.enqueue=function(a){var b=this.length++;this.items[b]=new l(d.count++,a);this.percolate(b)};f.remove=function(a){for(var b=0;b<this.length;b++)if(this.items[b].value===a)return this.removeAt(b),!0;return!1};d.count=0;var g=q.CompositeDisposable=function(){this.disposables=N(arguments,0);this.isDisposed=!1;this.length=this.disposables.length};
g.prototype.add=function(a){this.isDisposed?a.dispose():(this.disposables.push(a),this.length++)};g.prototype.remove=function(a){var b=!1;if(!this.isDisposed){var c=this.disposables.indexOf(a);-1!==c&&(b=!0,this.disposables.splice(c,1),this.length--,a.dispose())}return b};g.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var a=this.disposables.slice(0);this.disposables=[];for(var b=this.length=0,c=a.length;b<c;b++)a[b].dispose()}};g.prototype.clear=function(){var a=this.disposables.slice(0);
this.disposables=[];for(var b=this.length=0,c=a.length;b<c;b++)a[b].dispose()};g.prototype.contains=function(a){return-1!==this.disposables.indexOf(a)};g.prototype.toArray=function(){return this.disposables.slice(0)};var k=q.Disposable=function(a){this.isDisposed=!1;this.action=a};k.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var x=k.create=function(a){return new k(a)},m=k.empty={dispose:w},v=q.SingleAssignmentDisposable=function(){this.isDisposed=!1;this.current=
null};v.prototype.disposable=function(a){return!a?this.getDisposable():this.setDisposable(a)};v.prototype.getDisposable=function(){return this.current};v.prototype.setDisposable=function(a){if(this.current)throw Error("Disposable has already been assigned");var b=this.isDisposed;b||(this.current=a);b&&a&&a.dispose()};v.prototype.dispose=function(){var a;this.isDisposed||(this.isDisposed=!0,a=this.current,this.current=null);a&&a.dispose()};var u=q.SerialDisposable=function(){this.isDisposed=!1;this.current=
null};u.prototype.getDisposable=function(){return this.current};u.prototype.setDisposable=function(a){var b=this.isDisposed,c;b||(c=this.current,this.current=a);c&&c.dispose();b&&a&&a.dispose()};u.prototype.disposable=function(a){if(a)this.setDisposable(a);else return this.getDisposable()};u.prototype.dispose=function(){var a;this.isDisposed||(this.isDisposed=!0,a=this.current,this.current=null);a&&a.dispose()};var $=function(a){this.disposable=a;this.disposable.count++;this.isInnerDisposed=!1},C=
function(a){this.underlyingDisposable=a;this.isPrimaryDisposed=this.isDisposed=!1;this.count=0};$.prototype.dispose=function(){!this.disposable.isDisposed&&!this.isInnerDisposed&&(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))};C.prototype.dispose=function(){!this.isDisposed&&!this.isPrimaryDisposed&&(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=
!0,this.underlyingDisposable.dispose()))};C.prototype.getDisposable=function(){return this.isDisposed?m:new $(this)};var Fa=q.RefCountDisposable=C;z.prototype.dispose=function(){var a=this;this.scheduler.schedule(function(){a.isDisposed||(a.isDisposed=!0,a.disposable.dispose())})};n.prototype.invoke=function(){this.disposable.disposable(this.invokeCore())};n.prototype.compareTo=function(a){return this.comparer(this.dueTime,a.dueTime)};n.prototype.isCancelled=function(){return this.disposable.isDisposed};
n.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var P=function(a,b,c,e){this.now=a;this._schedule=b;this._scheduleRelative=c;this._scheduleAbsolute=e},Ga=function(a,b,c){var e=b.first,j=b.second,t=new g,d=function(b){j(b,function(b,e){var j=!1,g=!1,f=a[c].call(a,b,e,function(a,b){j?t.remove(f):g=!0;d(b);return m});g||(t.add(f),j=!0)})};d(e);return t},pa=function(a,b){b();return m},G=P.prototype;G.catchException=function(a){return new Ha(this,a)};G.schedulePeriodic=
function(a,b){return this.schedulePeriodicWithState(null,a,function(){b()})};G.schedulePeriodicWithState=function(a,b,c){var e=a,j=h.setInterval(function(){e=c(e)},b);return x(function(){h.clearInterval(j)})};G.schedule=function(a){return this._schedule(a,pa)};G.scheduleWithState=function(a,b){return this._schedule(a,b)};G.scheduleWithRelative=function(a,b){return this._scheduleRelative(b,a,pa)};G.scheduleWithRelativeAndState=function(a,b,c){return this._scheduleRelative(a,b,c)};G.scheduleWithAbsolute=
function(a,b){return this._scheduleAbsolute(b,a,pa)};G.scheduleWithAbsoluteAndState=function(a,b,c){return this._scheduleAbsolute(a,b,c)};G.scheduleRecursive=function(a){return this.scheduleRecursiveWithState(a,function(a,c){a(function(){c(a)})})};G.scheduleRecursiveWithState=function(a,b){return this.scheduleWithState({first:a,second:b},function(a,b){var j=b.first,t=b.second,d=new g,f=function(b){t(b,function(b){var e=!1,j=!1,t=a.scheduleWithState(b,function(a,b){e?d.remove(t):j=!0;f(b);return m});
j||(d.add(t),e=!0)})};f(j);return d})};G.scheduleRecursiveWithRelative=function(a,b){return this.scheduleRecursiveWithRelativeAndState(b,a,function(a,b){a(function(j){b(a,j)})})};G.scheduleRecursiveWithRelativeAndState=function(a,b,c){return this._scheduleRelative({first:a,second:c},b,function(a,b){return Ga(a,b,"scheduleWithRelativeAndState")})};G.scheduleRecursiveWithAbsolute=function(a,b){return this.scheduleRecursiveWithAbsoluteAndState(b,a,function(a,b){a(function(j){b(a,j)})})};G.scheduleRecursiveWithAbsoluteAndState=
function(a,b,c){return this._scheduleAbsolute({first:a,second:c},b,function(a,b){return Ga(a,b,"scheduleWithAbsoluteAndState")})};P.now=H;P.normalize=function(a){0>a&&(a=0);return a};var L=q.Scheduler=P,Ia;Ia=new L(H,function(a,b){return b(this,a)},function(a,b,c){if(0<b)throw Error("Scheduler is not allowed to block the thread");return c(this,a)},function(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)});var Q=L.immediate=Ia,qa=function(){U=new d(4)},U;qa.prototype.dispose=function(){U=
null};qa.prototype.run=function(){for(var a;0<U.length;)if(a=U.dequeue(),!a.isCancelled()){for(;0<a.dueTime-L.now(););a.isCancelled()||a.invoke()}};var ra=new L(H,function(a,b){return this.scheduleWithRelativeAndState(a,0,b)},function(a,b,c){b=this.now()+L.normalize(b);a=new n(this,a,c,b);if(U)U.enqueue(a);else{c=new qa;try{U.enqueue(a),c.run()}finally{c.dispose()}}return a.disposable},function(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)});ra.scheduleRequired=function(){return null===
U};ra.ensureTrampoline=function(a){return null===U?this.schedule(a):a()};var ba=L.currentThread=ra,bb=function(a,b){b(0,this._period);try{this._state=this._action(this._state)}catch(c){throw this._cancel.dispose(),c;}},Ja=function(a,b,c,e){this._scheduler=a;this._state=b;this._period=c;this._action=e};Ja.prototype.start=function(){var a=new v;this._cancel=a;a.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,bb.bind(this)));return a};var cb=function(){return this.toDateTimeOffset(this.clock)},
db=function(a,b){return this.scheduleAbsoluteWithState(a,this.clock,b)},eb=function(a,b,c){return this.scheduleRelativeWithState(a,this.toRelative(b),c)},fb=function(a,b,c){return this.scheduleRelativeWithState(a,this.toRelative(b-this.now()),c)},Ka=function(a,b){b();return m},ja=function(a,b){this.clock=a;this.comparer=b;this.isEnabled=!1;this.queue=new d(1024);ja.super_.constructor.call(this,cb,db,eb,fb)};D(ja,L);O(ja.prototype,{schedulePeriodicWithState:function(a,b,c){return(new Ja(this,a,b,c)).start()},
scheduleRelativeWithState:function(a,b,c){b=this.add(this.clock,b);return this.scheduleAbsoluteWithState(a,b,c)},scheduleRelative:function(a,b){return this.scheduleRelativeWithState(b,a,Ka)},start:function(){var a;if(!this.isEnabled){this.isEnabled=!0;do a=this.getNext(),null!==a?(0<this.comparer(a.dueTime,this.clock)&&(this.clock=a.dueTime),a.invoke()):this.isEnabled=!1;while(this.isEnabled)}},stop:function(){this.isEnabled=!1},advanceTo:function(a){var b;b=this.comparer(this.clock,a);if(0<this.comparer(this.clock,
a))throw Error("Argument out of range");if(0!==b&&!this.isEnabled){this.isEnabled=!0;do b=this.getNext(),null!==b&&0>=this.comparer(b.dueTime,a)?(0<this.comparer(b.dueTime,this.clock)&&(this.clock=b.dueTime),b.invoke()):this.isEnabled=!1;while(this.isEnabled);this.clock=a}},advanceBy:function(a){a=this.add(this.clock,a);var b=this.comparer(this.clock,a);if(0<b)throw Error("Argument out of range");if(0!==b)return this.advanceTo(a)},sleep:function(a){a=this.add(this.clock,a);if(0<=this.comparer(this.clock,
a))throw Error("Argument out of range");this.clock=a},getNext:function(){for(var a;0<this.queue.length;)if(a=this.queue.peek(),a.isCancelled())this.queue.dequeue();else return a;return null},scheduleAbsolute:function(a,b){return this.scheduleAbsoluteWithState(b,a,Ka)},scheduleAbsoluteWithState:function(a,b,c){var e=this,j=new n(e,a,function(a,b){e.queue.remove(j);return c(a,b)},b,e.comparer);e.queue.enqueue(j);return j.disposable}});q.VirtualTimeScheduler=ja;var ka=function(a,b){ka.super_.constructor.call(this,
null==a?0:a,b||S)};D(ka,q.VirtualTimeScheduler);var sa=ka.prototype;sa.add=function(a,b){return a+b};sa.toDateTimeOffset=function(a){return(new Date(a)).getTime()};sa.toRelative=function(a){return a};q.HistoricalScheduler=ka;var La,Ma=h.requestAnimationFrame||h.webkitRequestAnimationFrame||h.mozRequestAnimationFrame||h.oRequestAnimationFrame||h.msRequestAnimationFrame,gb=h.cancelAnimationFrame||h.webkitCancelAnimationFrame||h.mozCancelAnimationFrame||h.oCancelAnimationFrame||h.msCancelAnimationFrame,
fa,ga;"undefined"!==typeof h.process&&"function"===typeof h.process.nextTick?(fa=h.process.nextTick,ga=w):"function"===typeof h.setImmediate?(fa=h.setImmediate,ga=h.clearImmediate):"function"===typeof Ma?(fa=Ma,ga=gb):(fa=function(a){return h.setTimeout(a,0)},ga=h.clearTimeout);La=new L(H,function(a,b){var c=this,e=new v,j=fa(function(){e.setDisposable(b(c,a))});return new g(e,x(function(){ga(j)}))},function(a,b,c){var e=this;b=L.normalize(b);if(0===b)return e.scheduleWithState(a,c);var j=new v,t=
h.setTimeout(function(){j.setDisposable(c(e,a))},b);return new g(j,x(function(){h.clearTimeout(t)}))},function(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)});var hb=L.timeout=La,Ha,ib=function(){return this._scheduler.now()},jb=function(a,b){return this._scheduler.scheduleWithState(a,this._wrap(b))},kb=function(a,b,c){return this._scheduler.scheduleWithRelativeAndState(a,b,this._wrap(c))},lb=function(a,b,c){return this._scheduler.scheduleWithAbsoluteAndState(a,b,this._wrap(c))},
Y=function(a,b){this._scheduler=a;this._handler=b;this._recursiveWrapper=this._recursiveOriginal=null;Y.super_.constructor.call(this,ib,jb,kb,lb)};D(Y,L);Y.prototype._clone=function(a){return new Y(a,this._handler)};Y.prototype._wrap=function(a){var b=this;return function(c,e){try{return a(b._getRecursiveWrapper(c),e)}catch(j){if(!b._handler(j))throw j;return m}}};Y.prototype._getRecursiveWrapper=function(a){if(!this._recursiveOriginal!==a){this._recursiveOriginal=a;var b=this._clone(a);b._recursiveOriginal=
a;this._recursiveWrapper=b._recursiveWrapper=b}return this._recursiveWrapper};Y.prototype.schedulePeriodicWithState=function(a,b,c){var e=this,j=!1,t=new v;t.setDisposable(this._scheduler.schedulePeriodicWithState(a,b,function(a){if(j)return null;try{return c(a)}catch(b){j=!0;if(!e._handler(b))throw b;t.dispose();return null}}));return t};Ha=Y;var Na=function(){};O(Na.prototype,{accept:function(a,b,c){return 1<arguments.length||"function"===typeof a?this._accept(a,b,c):this._acceptObservable(a)},
toObservable:function(a){var b=this;a=a||Q;return new r(function(c){return a.schedule(function(){b._acceptObservable(c);if("N"===b.kind)c.onCompleted()})})},hasValue:!1,equals:function(a){return this.toString()===(null==a?"":a.toString())}});var ca=q.Notification=Na,ta=function(a){this.value=a;this.hasValue=!0;this.kind="N"};D(ta,ca);O(ta.prototype,{_accept:function(a){return a(this.value)},_acceptObservable:function(a){return a.onNext(this.value)},toString:function(){return"OnNext("+this.value+")"}});
var Oa=ca.createOnNext=function(a){return new ta(a)},ua=function(a){this.exception=a;this.kind="E"};D(ua,ca);O(ua.prototype,{_accept:function(a,b){return b(this.exception)},_acceptObservable:function(a){return a.onError(this.exception)},toString:function(){return"OnError("+this.exception+")"}});var Pa=ca.createOnError=function(a){return new ua(a)},va=function(){this.kind="C"};D(va,ca);O(va.prototype,{_accept:function(a,b,c){return c()},_acceptObservable:function(a){return a.onCompleted()},toString:function(){return"OnCompleted()"}});
var Qa=ca.createOnCompleted=function(){return new va},Ra=q.Internals.Enumerator=function(a,b,c){this.moveNext=a;this.getCurrent=b;this.dispose=c},Sa=Ra.create=function(a,b,c){var e=!1;c||(c=w);return new Ra(function(){if(e)return!1;var b=a();b||(e=!0,c());return b},function(){return b()},function(){e||(c(),e=!0)})},mb=q.Internals,wa=function(a){this.getEnumerator=a};wa.prototype.concat=function(){var a=this;return new r(function(b){var c=a.getEnumerator(),e=!1,j=new u,t=Q.scheduleRecursive(function(a){var t,
g,d=!1;if(!e){try{(d=c.moveNext())?t=c.getCurrent():c.dispose()}catch(f){g=f,c.dispose()}if(g)b.onError(g);else if(d)g=new v,j.setDisposable(g),g.setDisposable(t.subscribe(b.onNext.bind(b),b.onError.bind(b),function(){a()}));else b.onCompleted()}});return new g(j,t,x(function(){e=!0;c.dispose()}))})};wa.prototype.catchException=function(){var a=this;return new r(function(b){var c=a.getEnumerator(),e=!1,j,t=new u,d=Q.scheduleRecursive(function(a){var g,d,f;f=!1;if(!e){try{(f=c.moveNext())&&(g=c.getCurrent())}catch(k){d=
k}if(d)b.onError(d);else if(f)d=new v,t.setDisposable(d),d.setDisposable(g.subscribe(b.onNext.bind(b),function(b){j=b;a()},b.onCompleted.bind(b)));else if(j)b.onError(j);else b.onCompleted()}});return new g(t,d,x(function(){e=!0}))})};var la=mb.Enumerable=wa,Ta=la.repeat=function(a,b){b===p&&(b=-1);return new la(function(){var c,e=b;return Sa(function(){if(0===e)return!1;0<e&&e--;c=a;return!0},function(){return c})})},xa=la.forEach=function(a,b){b||(b=F);return new la(function(){var c,e=-1;return Sa(function(){return++e<
a.length?(c=b(a[e],e),!0):!1},function(){return c})})},R=q.Observer=function(){};R.prototype.toNotifier=function(){var a=this;return function(b){return b.accept(a)}};R.prototype.asObserver=function(){return new ya(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))};R.prototype.checked=function(){return new Ua(this)};var nb=R.create=function(a,b,c){a||(a=w);b||(b=y);c||(c=w);return new ya(a,b,c)};R.fromNotifier=function(a){return new ya(function(b){return a(Oa(b))},function(b){return a(Pa(b))},
function(){return a(Qa())})};var ob=q.Internals,aa=function(){this.isStopped=!1};D(aa,R);aa.prototype.onNext=function(a){this.isStopped||this.next(a)};aa.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.error(a))};aa.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())};aa.prototype.dispose=function(){this.isStopped=!0};aa.prototype.fail=function(){return!this.isStopped?(this.isStopped=!0,this.error(!0),!0):!1};var za=ob.AbstractObserver=aa,da=
function(a,b,c){da.super_.constructor.call(this);this._onNext=a;this._onError=b;this._onCompleted=c};D(da,za);da.prototype.next=function(a){this._onNext(a)};da.prototype.error=function(a){this._onError(a)};da.prototype.completed=function(){this._onCompleted()};var ya=q.AnonymousObserver=da,Ua,ea=function(a){this._observer=a;this._state=0};D(ea,R);ea.prototype.onNext=function(a){this.checkAccess();try{this._observer.onNext(a)}finally{this._state=0}};ea.prototype.onError=function(a){this.checkAccess();
try{this._observer.onError(a)}finally{this._state=2}};ea.prototype.onCompleted=function(){this.checkAccess();try{this._observer.onCompleted()}finally{this._state=2}};ea.prototype.checkAccess=function(){if(1===this._state)throw Error("Re-entrancy detected");if(2===this._state)throw Error("Observer completed");0===this._state&&(this._state=1)};Ua=ea;var pb=q.Internals,V=function(a,b){V.super_.constructor.call(this);this.scheduler=a;this.observer=b;this.hasFaulted=this.isAcquired=!1;this.queue=[];this.disposable=
new u};D(V,za);V.prototype.next=function(a){var b=this;this.queue.push(function(){b.observer.onNext(a)})};V.prototype.error=function(a){var b=this;this.queue.push(function(){b.observer.onError(a)})};V.prototype.completed=function(){var a=this;this.queue.push(function(){a.observer.onCompleted()})};V.prototype.ensureActive=function(){var a=!1,b=this;!this.hasFaulted&&0<this.queue.length&&(a=!this.isAcquired,this.isAcquired=!0);a&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(a){var e;
if(0<b.queue.length){e=b.queue.shift();try{e()}catch(j){throw b.queue=[],b.hasFaulted=!0,j;}a()}else b.isAcquired=!1}))};V.prototype.dispose=function(){V.super_.dispose.call(this);this.disposable.dispose()};var qb=pb.ScheduledObserver=V,Va,W=function(){W.super_.constructor.apply(this,arguments)};D(W,qb);W.prototype.next=function(a){W.super_.next.call(this,a);this.ensureActive()};W.prototype.error=function(a){W.super_.error.call(this,a);this.ensureActive()};W.prototype.completed=function(){W.super_.completed.call(this);
this.ensureActive()};Va=W;var s,Wa=function(a){this._subscribe=a};s=Wa.prototype;s.finalValue=function(){var a=this;return new r(function(b){var c=!1,e;return a.subscribe(function(a){c=!0;e=a},b.onError.bind(b),function(){if(c)b.onNext(e),b.onCompleted();else b.onError(Error("Sequence contains no elements."))})})};s.subscribe=function(a,b,c){var e;e=0===arguments.length||1<arguments.length||"function"===typeof a?nb(a,b,c):a;return this._subscribe(e)};s.toArray=function(){return this.scan([],function(a,
b){a.push(b);return a.slice(0)}).startWith([]).finalValue()};var B=q.Observable=Wa;B.start=function(a,b){return rb(a,b)()};var rb=B.toAsync=function(a,b,c){b||(b=hb);return function(){var e=A.call(arguments,0),j=new sb;b.schedule(function(){var b;try{b=a.apply(c,e)}catch(g){j.onError(g);return}j.onNext(b);j.onCompleted()});return j.asObservable()}};s.observeOn=function(a){var b=this;return new r(function(c){return b.subscribe(new Va(a,c))})};s.subscribeOn=function(a){var b=this;return new r(function(c){var e=
new v,j=new u;j.setDisposable(e);e.setDisposable(a.schedule(function(){j.setDisposable(new z(a,b.subscribe(c)))}));return j})};B.create=function(a){return new r(function(b){return x(a(b))})};B.createWithDisposable=function(a){return new r(a)};var tb=B.defer=function(a){return new r(function(b){var c;try{c=a()}catch(e){return Xa(e).subscribe(b)}return c.subscribe(b)})},ub=B.empty=function(a){a||(a=Q);return new r(function(b){return a.schedule(function(){b.onCompleted()})})},Aa=B.fromArray=function(a,
b){b||(b=ba);return new r(function(c){var e=0;return b.scheduleRecursive(function(b){if(e<a.length)c.onNext(a[e++]),b();else c.onCompleted()})})};B.generate=function(a,b,c,e,j){j||(j=ba);return new r(function(t){var g=!0,d=a;return j.scheduleRecursive(function(a){var j,f;try{g?g=!1:d=c(d),(j=b(d))&&(f=e(d))}catch(k){t.onError(k);return}if(j)t.onNext(f),a();else t.onCompleted()})})};var Ya=B.never=function(){return new r(function(){return m})};B.range=function(a,b,c){c||(c=ba);return new r(function(e){return c.scheduleRecursiveWithState(0,
function(c,t){if(c<b)e.onNext(a+c),t(c+1);else e.onCompleted()})})};B.repeat=function(a,b,c){c||(c=ba);b==p&&(b=-1);return vb(a,c).repeat(b)};var vb=B.returnValue=function(a,b){b||(b=Q);return new r(function(c){return b.schedule(function(){c.onNext(a);c.onCompleted()})})},Xa=B.throwException=function(a,b){b||(b=Q);return new r(function(c){return b.schedule(function(){c.onError(a)})})};B.using=function(a,b){return new r(function(c){var e=m,j,t;try{(j=a())&&(e=j),t=b(j)}catch(d){return new g(Xa(d).subscribe(c),
e)}return new g(t.subscribe(c),e)})};s.amb=function(a){var b=this;return new r(function(c){function e(){d||(d=f,l.dispose())}function j(){d||(d=k,m.dispose())}var d,f="L",k="R",m=new v,l=new v;m.setDisposable(b.subscribe(function(a){e();if(d===f)c.onNext(a)},function(a){e();if(d===f)c.onError(a)},function(){e();if(d===f)c.onCompleted()}));l.setDisposable(a.subscribe(function(a){j();if(d===k)c.onNext(a)},function(a){j();if(d===k)c.onError(a)},function(){j();if(d===k)c.onCompleted()}));return new g(m,
l)})};B.amb=function(){for(var a=Ya(),b=N(arguments,0),c=0,e=b.length;c<e;c++)a=a.amb(b[c]);return a};s.catchException=function(a){if("function"===typeof a){var b=this;return new r(function(c){var e=new v,j=new u;j.setDisposable(e);e.setDisposable(b.subscribe(c.onNext.bind(c),function(b){var e;try{e=a(b)}catch(d){c.onError(d);return}b=new v;j.setDisposable(b);b.setDisposable(e.subscribe(c))},c.onCompleted.bind(c)));return j})}return wb([this,a])};var wb=B.catchException=function(){var a=N(arguments,
0);return xa(a).catchException()};s.combineLatest=function(){var a=A.call(arguments);Array.isArray(a[0])?a[0].unshift(this):a.unshift(this);return xb.apply(this,a)};var xb=B.combineLatest=function(){var a=A.call(arguments),b=a.pop();Array.isArray(a[0])&&(a=a[0]);return new r(function(c){for(var e=function(){return!1},j=a.length,d=T(j,e),f=!1,k=T(j,e),m=Array(j),l=Array(j),e=0;e<j;e++)(function(e){l[e]=new v;l[e].setDisposable(a[e].subscribe(function(a){m[e]=a;a:{var j;d[e]=!0;if(f||(f=d.every(function(a){return a}))){try{j=
b.apply(null,m)}catch(g){c.onError(g);break a}c.onNext(j)}else if(k.filter(function(a,b){return b!==e}).every(function(a){return a}))c.onCompleted()}},c.onError.bind(c),function(){k[e]=!0;if(k.every(function(a){return a}))c.onCompleted()}))})(e);return new g(l)})};s.concat=function(){var a=A.call(arguments,0);a.unshift(this);return yb.apply(this,a)};var yb=B.concat=function(){var a=N(arguments,0);return xa(a).concat()};s.concatObservable=s.concatAll=function(){return this.merge(1)};s.merge=function(a){if("number"!==
typeof a)return zb(this,a);var b=this;return new r(function(c){var e=0,j=new g,d=!1,f=[],k=function(a){var b=new v;j.add(b);b.setDisposable(a.subscribe(c.onNext.bind(c),c.onError.bind(c),function(){var a;j.remove(b);if(0<f.length)a=f.shift(),k(a);else if(e--,d&&0===e)c.onCompleted()}))};j.add(b.subscribe(function(b){e<a?(e++,k(b)):f.push(b)},c.onError.bind(c),function(){d=!0;if(0===e)c.onCompleted()}));return j})};var zb=B.merge=function(){var a,b;arguments[0]?arguments[0].now?(a=arguments[0],b=A.call(arguments,
1)):(a=Q,b=A.call(arguments,0)):(a=Q,b=A.call(arguments,1));Array.isArray(b[0])&&(b=b[0]);return Aa(b,a).mergeObservable()};s.mergeObservable=s.mergeAll=function(){var a=this;return new r(function(b){var c=new g,e=!1,j=new v;c.add(j);j.setDisposable(a.subscribe(function(a){var j=new v;c.add(j);j.setDisposable(a.subscribe(function(a){b.onNext(a)},b.onError.bind(b),function(){c.remove(j);if(e&&1===c.length)b.onCompleted()}))},b.onError.bind(b),function(){e=!0;if(1===c.length)b.onCompleted()}));return c})};
s.onErrorResumeNext=function(a){if(!a)throw Error("Second observable is required");return Ab([this,a])};var Ab=B.onErrorResumeNext=function(){var a=N(arguments,0);return new r(function(b){var c=0,e=new u,j=Q.scheduleRecursive(function(j){var d,g;if(c<a.length)d=a[c++],g=new v,e.setDisposable(g),g.setDisposable(d.subscribe(b.onNext.bind(b),function(){j()},function(){j()}));else b.onCompleted()});return new g(e,j)})};s.skipUntil=function(a){var b=this;return new r(function(c){var e=!1,j=new g(b.subscribe(function(a){if(e)c.onNext(a)},
c.onError.bind(c),function(){if(e)c.onCompleted()})),d=new v;j.add(d);d.setDisposable(a.subscribe(function(){e=!0;d.dispose()},c.onError.bind(c),function(){d.dispose()}));return j})};s.switchLatest=function(){var a=this;return new r(function(b){var c=!1,e=new u,j=!1,d=0,f=a.subscribe(function(a){var g=new v,f=++d;c=!0;e.setDisposable(g);g.setDisposable(a.subscribe(function(a){if(d===f)b.onNext(a)},function(a){if(d===f)b.onError(a)},function(){if(d===f&&(c=!1,j))b.onCompleted()}))},b.onError.bind(b),
function(){j=!0;if(!c)b.onCompleted()});return new g(f,e)})};s.takeUntil=function(a){var b=this;return new r(function(c){return new g(b.subscribe(c),a.subscribe(c.onCompleted.bind(c),c.onError.bind(c),w))})};s.zip=function(){if(Array.isArray(arguments[0]))return K.apply(this,arguments);var a=this,b=A.call(arguments),c=b.pop();b.unshift(a);return new r(function(e){for(var j=b.length,d=T(j,function(){return[]}),f=T(j,function(){return!1}),k=Array(j),m=0;m<j;m++)(function(j){k[j]=new v;k[j].setDisposable(b[j].subscribe(function(b){d[j].push(b);
a:{var g,k;if(d.every(function(a){return 0<a.length})){try{k=d.map(function(a){return a.shift()}),g=c.apply(a,k)}catch(m){e.onError(m);break a}e.onNext(g)}else if(f.filter(function(a,b){return b!==j}).every(function(a){return a}))e.onCompleted()}},e.onError.bind(e),function(){f[j]=!0;if(f.every(function(a){return a}))e.onCompleted()}))})(m);return new g(k)})};s.asObservable=function(){var a=this;return new r(function(b){return a.subscribe(b)})};s.bufferWithCount=function(a,b){b===p&&(b=a);return this.windowWithCount(a,
b).selectMany(function(a){return a.toArray()}).where(function(a){return 0<a.length})};s.dematerialize=function(){var a=this;return new r(function(b){return a.subscribe(function(a){return a.accept(b)},b.onError.bind(b),b.onCompleted.bind(b))})};s.distinctUntilChanged=function(a,b){var c=this;a||(a=F);b||(b=M);return new r(function(e){var j=!1,d;return c.subscribe(function(c){var g=!1,f;try{f=a(c)}catch(k){e.onError(k);return}if(j)try{g=b(d,f)}catch(m){e.onError(m);return}if(!j||!g)j=!0,d=f,e.onNext(c)},
e.onError.bind(e),e.onCompleted.bind(e))})};s.doAction=function(a,b,c){var e=this,j;"function"===typeof a?j=a:(j=a.onNext.bind(a),b=a.onError.bind(a),c=a.onCompleted.bind(a));return new r(function(a){return e.subscribe(function(b){try{j(b)}catch(c){a.onError(c)}a.onNext(b)},function(c){if(b)try{b(c)}catch(e){a.onError(e)}a.onError(c)},function(){if(c)try{c()}catch(b){a.onError(b)}a.onCompleted()})})};s.finallyAction=function(a){var b=this;return new r(function(c){var e=b.subscribe(c);return x(function(){try{e.dispose()}finally{a()}})})};
s.ignoreElements=function(){var a=this;return new r(function(b){return a.subscribe(w,b.onError.bind(b),b.onCompleted.bind(b))})};s.materialize=function(){var a=this;return new r(function(b){return a.subscribe(function(a){b.onNext(Oa(a))},function(a){b.onNext(Pa(a));b.onCompleted()},function(){b.onNext(Qa());b.onCompleted()})})};s.repeat=function(a){return Ta(this,a).concat()};s.retry=function(a){return Ta(this,a).catchException()};s.scan=function(){var a,b=!1,c;2===arguments.length?(a=arguments[0],
c=arguments[1],b=!0):c=arguments[0];var e=this;return tb(function(){var j=!1,d;return e.select(function(e){j?d=c(d,e):(d=b?c(a,e):e,j=!0);return d})})};s.skipLast=function(a){var b=this;return new r(function(c){var e=[];return b.subscribe(function(b){e.push(b);if(e.length>a)c.onNext(e.shift())},c.onError.bind(c),c.onCompleted.bind(c))})};s.startWith=function(){var a,b;a=0;0<arguments.length&&null!=arguments[0]&&arguments[0].now!==p?(b=arguments[0],a=1):b=Q;a=A.call(arguments,a);return xa([Aa(a,b),
this]).concat()};s.takeLast=function(a,b){return this.takeLastBuffer(a).selectMany(function(a){return Aa(a,b)})};s.takeLastBuffer=function(a){var b=this;return new r(function(c){var e=[];return b.subscribe(function(b){e.push(b);e.length>a&&e.shift()},c.onError.bind(c),function(){c.onNext(e);c.onCompleted()})})};s.windowWithCount=function(a,b){var c=this;if(0>=a)throw Error("Argument out of range");null==b&&(b=a);if(0>=b)throw Error("Argument out of range");return new r(function(e){var d=new v,g=new Fa(d),
f=0,k=[],m=function(){var a=new Za;k.push(a);e.onNext(oa(a,g))};m();d.setDisposable(c.subscribe(function(c){for(var e=0,d=k.length;e<d;e++)k[e].onNext(c);c=f-a+1;0<=c&&0===c%b&&(c=k.shift(),c.onCompleted());f++;0===f%b&&m()},function(a){for(;0<k.length;)k.shift().onError(a);e.onError(a)},function(){for(;0<k.length;)k.shift().onCompleted();e.onCompleted()}));return g})};s.defaultIfEmpty=function(a){var b=this;a===p&&(a=null);return new r(function(c){var e=!1;return b.subscribe(function(a){e=!0;c.onNext(a)},
c.onError.bind(c),function(){if(!e)c.onNext(a);c.onCompleted()})})};s.distinct=function(a,b){var c=this;a||(a=F);b||(b=J);return new r(function(e){var d={};return c.subscribe(function(c){var g,f,k,m=!1;try{g=a(c),f=b(g)}catch(l){e.onError(l);return}for(k in d)if(f===k){m=!0;break}m||(d[f]=null,e.onNext(c))},e.onError.bind(e),e.onCompleted.bind(e))})};s.groupBy=function(a,b,c){return this.groupByUntil(a,b,function(){return Ya()},c)};s.groupByUntil=function(a,b,c,e){var d=this;b||(b=F);e||(e=J);return new r(function(f){var k=
{},m=new g,l=new Fa(m);m.add(d.subscribe(function(d){var j,g,x,h,u,C,$,s,r;try{g=a(d),C=e(g)}catch(P){for(r in k)k[r].onError(P);f.onError(P);return}u=!1;try{s=k[C],s||(s=new Za,k[C]=s,u=!0)}catch(q){for(r in k)k[r].onError(q);f.onError(q);return}if(u){u=new Ba(g,s,l);g=new Ba(g,s);try{j=c(g)}catch(n){for(r in k)k[r].onError(n);f.onError(n);return}f.onNext(u);$=new v;m.add($);h=function(){C in k&&(delete k[C],s.onCompleted());m.remove($)};$.setDisposable(j.take(1).subscribe(w,function(a){for(r in k)k[r].onError(a);
f.onError(a)},function(){h()}))}try{x=b(d)}catch(p){for(r in k)k[r].onError(p);f.onError(p);return}s.onNext(x)},function(a){for(var b in k)k[b].onError(a);f.onError(a)},function(){for(var a in k)k[a].onCompleted();f.onCompleted()}));return l})};s.select=s.map=function(a){var b=this;return new r(function(c){var e=0;return b.subscribe(function(b){var d;try{d=a(b,e++)}catch(g){c.onError(g);return}c.onNext(d)},c.onError.bind(c),c.onCompleted.bind(c))})};s.selectMany=s.flatMap=function(a,b){return b?this.selectMany(function(c){return a(c).select(function(a){return b(c,
a)})}):"function"===typeof a?this.select(a).mergeObservable():this.select(function(){return a}).mergeObservable()};s.skip=function(a){if(0>a)throw Error("Argument out of range");var b=this;return new r(function(c){var e=a;return b.subscribe(function(a){if(0>=e)c.onNext(a);else e--},c.onError.bind(c),c.onCompleted.bind(c))})};s.skipWhile=function(a){var b=this;return new r(function(c){var e=0,d=!1;return b.subscribe(function(b){if(!d)try{d=!a(b,e++)}catch(g){c.onError(g);return}if(d)c.onNext(b)},c.onError.bind(c),
c.onCompleted.bind(c))})};s.take=function(a,b){if(0>a)throw Error("Argument out of range");if(0===a)return ub(b);var c=this;return new r(function(b){var d=a;return c.subscribe(function(a){if(0<d&&(d--,b.onNext(a),0===d))b.onCompleted()},b.onError.bind(b),b.onCompleted.bind(b))})};s.takeWhile=function(a){var b=this;return new r(function(c){var e=0,d=!0;return b.subscribe(function(b){if(d){try{d=a(b,e++)}catch(g){c.onError(g);return}if(d)c.onNext(b);else c.onCompleted()}},c.onError.bind(c),c.onCompleted.bind(c))})};
s.where=s.filter=function(a){var b=this;return new r(function(c){var e=0;return b.subscribe(function(b){var d;try{d=a(b,e++)}catch(g){c.onError(g);return}if(d)c.onNext(b)},c.onError.bind(c),c.onCompleted.bind(c))})};var Bb=q.Internals,Ca=function(a){Ca.super_.constructor.call(this,function(b){var c=new $a(b);if(ba.scheduleRequired())ba.schedule(function(){try{c.disposable(a(c))}catch(b){if(!c.fail(b))throw b;}});else try{c.disposable(a(c))}catch(e){if(!c.fail(e))throw e;}return c})};D(Ca,B);var r=
Bb.AnonymousObservable=Ca,$a,X=function(a){X.super_.constructor.call(this);this.observer=a;this.m=new v};D(X,za);X.prototype.next=function(a){var b=!1;try{this.observer.onNext(a),b=!0}finally{b||this.dispose()}};X.prototype.error=function(a){try{this.observer.onError(a)}finally{this.dispose()}};X.prototype.completed=function(){try{this.observer.onCompleted()}finally{this.dispose()}};X.prototype.disposable=function(a){return this.m.disposable(a)};X.prototype.dispose=function(){X.super_.dispose.call(this);
this.m.dispose()};$a=X;var Ba,Cb=function(a){return this.underlyingObservable.subscribe(a)},Da=function(a,b,c){Da.super_.constructor.call(this,Cb);this.key=a;this.underlyingObservable=!c?b:new r(function(a){return new g(c.getDisposable(),b.subscribe(a))})};D(Da,B);Ba=Da;var Ea=function(a,b){this.subject=a;this.observer=b};Ea.prototype.dispose=function(){if(!this.subject.isDisposed&&null!==this.observer){var a=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(a,1);this.observer=
null}};var Db=function(a){E.call(this);if(!this.isStopped)return this.observers.push(a),new Ea(this,a);if(this.exception)return a.onError(this.exception),m;a.onCompleted();return m},ha=function(){ha.super_.constructor.call(this,Db);this.isStopped=this.isDisposed=!1;this.observers=[]};D(ha,B);O(ha.prototype,R,{onCompleted:function(){E.call(this);if(!this.isStopped){var a=this.observers.slice(0);this.isStopped=!0;for(var b=0,c=a.length;b<c;b++)a[b].onCompleted();this.observers=[]}},onError:function(a){E.call(this);
if(!this.isStopped){var b=this.observers.slice(0);this.isStopped=!0;this.exception=a;for(var c=0,e=b.length;c<e;c++)b[c].onError(a);this.observers=[]}},onNext:function(a){E.call(this);if(!this.isStopped)for(var b=this.observers.slice(0),c=0,e=b.length;c<e;c++)b[c].onNext(a)},dispose:function(){this.isDisposed=!0;this.observers=null}});ha.create=function(a,b){return new ab(a,b)};var Za=q.Subject=ha,Eb=function(a){E.call(this);if(!this.isStopped)return this.observers.push(a),new Ea(this,a);var b=this.exception,
c=this.hasValue,e=this.value;if(b)a.onError(b);else{if(c)a.onNext(e);a.onCompleted()}return m},ma=function(){ma.super_.constructor.call(this,Eb);this.isStopped=this.isDisposed=!1;this.value=null;this.hasValue=!1;this.observers=[];this.exception=null};D(ma,B);O(ma.prototype,R,{onCompleted:function(){var a,b,c;E.call(this);if(!this.isStopped){var e=this.observers.slice(0);this.isStopped=!0;var d=this.value;if(this.hasValue){b=0;for(c=e.length;b<c;b++)a=e[b],a.onNext(d),a.onCompleted()}else{b=0;for(c=
e.length;b<c;b++)e[b].onCompleted()}this.observers=[]}},onError:function(a){E.call(this);if(!this.isStopped){var b=this.observers.slice(0);this.isStopped=!0;this.exception=a;for(var c=0,e=b.length;c<e;c++)b[c].onError(a);this.observers=[]}},onNext:function(a){E.call(this);this.isStopped||(this.value=a,this.hasValue=!0)},dispose:function(){this.isDisposed=!0;this.value=this.exception=this.observers=null}});var sb=q.AsyncSubject=ma,ab,Fb=function(a){return this.observable.subscribe(a)},na=function(a,
b){na.super_.constructor.call(this,Fb);this.observer=a;this.observable=b};D(na,B);O(na.prototype,R,{onCompleted:function(){this.observer.onCompleted()},onError:function(a){this.observer.onError(a)},onNext:function(a){this.observer.onNext(a)}});ab=na;if("function"==typeof define&&"object"==typeof define.amd&&define.amd)return h.Rx=q,define("rx",[],function(){return q});I?"object"==typeof module&&module&&module.exports==I?module.exports=q:I=q:h.Rx=q})(this);
(function(h,p){var w="object"==typeof exports&&exports&&("object"==typeof h&&h&&h==h.global&&(window=h),exports);"function"===typeof define&&define.amd?define("rx.time",["rx","exports"],function(w,H){h.Rx=p(h,H,w);return h.Rx}):"object"==typeof module&&module&&module.exports==w?module.exports=p(h,module.exports,require("./rx")):h.Rx=p(h,{},h.Rx)})(this,function(h,p,w,F){function H(l,d,f){var g=D(d);return new y(function(d){var x=0,m=l;return f.scheduleRecursiveWithAbsolute(m,function(l){var u;0<g&&
(u=f.now(),m+=g,m<=u&&(m=u+g));d.onNext(x++);l(m)})})}function M(l,d,f){return l===d?new y(function(g){return f.schedulePeriodicWithState(0,d,function(d){g.onNext(d);return d+1})}):E(function(){return H(f.now()+l,d,f)})}function S(l,d){var f=this;return new y(function(g){var k=!1,x=new I,m=null,v=[],u=!1,h;h=f.materialize().timestamp(d).subscribe(function(f){"E"===f.value.kind?(v=[],v.push(f),m=f.value.exception,f=!u):(v.push({value:f.value,timestamp:f.timestamp+l}),f=!k,k=!0);if(f)if(null!==m)g.onError(m);
else f=new K,x.disposable(f),f.disposable(d.scheduleRecursiveWithRelative(l,function(f){var l,x,h;if(null===m){u=!0;do l=null,0<v.length&&0>=v[0].timestamp-d.now()&&(l=v.shift().value),null!==l&&l.accept(g);while(null!==l);h=!1;x=0;0<v.length?(h=!0,x=Math.max(0,v[0].timestamp-d.now())):k=!1;l=m;u=!1;if(null!==l)g.onError(l);else h&&f(x)}}))});return new q(h,x)})}function J(l,d){return new y(function(f){function g(){m&&(m=!1,f.onNext(x));if(k)f.onCompleted()}var k,x,m;return new q(l.subscribe(function(d){m=
!0;x=d},f.onError.bind(f),function(){k=!0}),d.subscribe(g,f.onError.bind(f),g))})}h=w.Observable;p=h.prototype;var y=w.Internals.AnonymousObservable,E=h.defer,N=h.empty,T=h.throwException,z=h.fromArray,n=w.Scheduler.timeout,K=w.SingleAssignmentDisposable,I=w.SerialDisposable,q=w.CompositeDisposable,ia=w.RefCountDisposable,A=w.Subject,Z=w.Internals.addRef,D=w.Scheduler.normalize,O=h.interval=function(l,d){d||(d=n);return M(l,l,d)},oa=h.timer=function(l,d,f){var g;f||(f=n);d!==F&&"number"===typeof d?
g=d:d!==F&&"object"===typeof d&&(f=d);if(l instanceof Date&&g===F){var k=l.getTime(),x=f;return new y(function(d){return x.scheduleWithAbsolute(k,function(){d.onNext(0);d.onCompleted()})})}if(l instanceof Date&&g!==F)return H(l.getTime(),d,f);if(g===F){var m=f,h=D(l);return new y(function(d){return m.scheduleWithRelative(h,function(){d.onNext(0);d.onCompleted()})})}return M(l,g,f)};p.delay=function(l,d){d||(d=n);var f;if(l instanceof Date){var g=l.getTime(),k=d,x=this;f=E(function(){var d=g-k.now();
return S.call(x,d,k)})}else f=S.call(this,l,d);return f};p.throttle=function(l,d){d||(d=n);var f=this;return new y(function(g){var k=new I,x=!1,m=0,h,u=null;h=f.subscribe(function(f){var h;x=!0;u=f;m++;h=m;f=new K;k.disposable(f);f.disposable(d.scheduleWithRelative(l,function(){if(x&&m===h)g.onNext(u);x=!1}))},function(d){k.dispose();g.onError(d);x=!1;m++},function(){k.dispose();if(x)g.onNext(u);g.onCompleted();x=!1;m++});return new q(h,k)})};p.windowWithTime=function(l,d,f){var g=this,k;d===F&&(k=
l);f===F&&(f=n);"number"===typeof d?k=d:"object"===typeof d&&(k=l,f=d);return new y(function(d){var m,h,u=k,n=l,C=[],p,P=new I,z=0;h=new q(P);p=new ia(h);m=function(){var g,l,h,v,q;h=new K;P.disposable(h);g=l=!1;n===u?g=l=!0:n<u?l=!0:g=!0;v=l?n:u;q=v-z;z=v;l&&(n+=k);g&&(u+=k);h.disposable(f.scheduleWithRelative(q,function(){var f;g&&(f=new A,C.push(f),d.onNext(Z(f,p)));l&&(f=C.shift(),f.onCompleted());m()}))};C.push(new A);d.onNext(Z(C[0],p));m();h.add(g.subscribe(function(d){var f,g;for(f=0;f<C.length;f++)g=
C[f],g.onNext(d)},function(f){var g,k;for(g=0;g<C.length;g++)k=C[g],k.onError(f);d.onError(f)},function(){var f,g;for(f=0;f<C.length;f++)g=C[f],g.onCompleted();d.onCompleted()}));return p})};p.windowWithTimeOrCount=function(l,d,f){var g=this;f||(f=n);return new y(function(k){var h,m,v=0,u,n,C=new I,p=0;m=new q(C);u=new ia(m);h=function(d){var g=new K;C.disposable(g);g.disposable(f.scheduleWithRelative(l,function(){var f;d===p&&(v=0,f=++p,n.onCompleted(),n=new A,k.onNext(Z(n,u)),h(f))}))};n=new A;
k.onNext(Z(n,u));h(0);m.add(g.subscribe(function(f){var g=0,l=!1;n.onNext(f);v++;v===d&&(l=!0,v=0,g=++p,n.onCompleted(),n=new A,k.onNext(Z(n,u)));l&&h(g)},function(d){n.onError(d);k.onError(d)},function(){n.onCompleted();k.onCompleted()}));return u})};p.bufferWithTime=function(l,d,f){var g;d===F&&(g=l);f||(f=n);"number"===typeof d?g=d:"object"===typeof d&&(g=l,f=d);return this.windowWithTime(l,g,f).selectMany(function(d){return d.toArray()})};p.bufferWithTimeOrCount=function(l,d,f){f||(f=n);return this.windowWithTimeOrCount(l,
d,f).selectMany(function(d){return d.toArray()})};p.timeInterval=function(l){var d=this;l||(l=n);return E(function(){var f=l.now();return d.select(function(d){var k=l.now(),h=k-f;f=k;return{value:d,interval:h}})})};p.timestamp=function(l){l||(l=n);return this.select(function(d){return{value:d,timestamp:l.now()}})};p.sample=function(l,d){d||(d=n);return"number"===typeof l?J(this,O(l,d)):J(this,l)};p.timeout=function(l,d,f){var g,k=this;d||(d=T(Error("Timeout")));f||(f=n);g=l instanceof Date?function(d,
g){f.scheduleWithAbsolute(d,g)}:function(d,g){f.scheduleWithRelative(d,g)};return new y(function(f){var m,h=0,u=new K,n=new I,p=!1,z=new I;n.disposable(u);m=function(){var k=h;z.disposable(g(l,function(){(p=h===k)&&n.disposable(d.subscribe(f))}))};m();u.disposable(k.subscribe(function(d){p||(h++,f.onNext(d),m())},function(d){p||(h++,f.onError(d))},function(){p||(h++,f.onCompleted())}));return new q(n,z)})};h.generateWithAbsoluteTime=function(l,d,f,g,k,h){h||(h=n);return new y(function(m){var n=!0,
u=!1,p,q=l,z;return h.scheduleRecursiveWithAbsolute(h.now(),function(l){if(u)m.onNext(p);try{if(n?n=!1:q=f(q),u=d(q))p=g(q),z=k(q)}catch(h){m.onError(h);return}if(u)l(z);else m.onCompleted()})})};h.generateWithRelativeTime=function(l,d,f,g,k,h){h||(h=n);return new y(function(m){var n=!0,u=!1,p,q=l,z;return h.scheduleRecursiveWithRelative(0,function(l){if(u)m.onNext(p);try{if(n?n=!1:q=f(q),u=d(q))p=g(q),z=k(q)}catch(h){m.onError(h);return}if(u)l(z);else m.onCompleted()})})};p.delaySubscription=function(l,
d){d||(d=n);return this.delayWithSelector(oa(l,d),function(){return N()})};p.delayWithSelector=function(l,d){var f=this,g,k;"function"===typeof l?k=l:(g=l,k=d);return new y(function(d){var l=new q,h=!1,n=function(){if(h&&0===l.length)d.onCompleted()},p=new I,z=function(){p.setDisposable(f.subscribe(function(f){var g;try{g=k(f)}catch(h){d.onError(h);return}var p=new K;l.add(p);p.setDisposable(g.subscribe(function(){d.onNext(f);l.remove(p);n()},d.onError.bind(d),function(){d.onNext(f);l.remove(p);n()}))},
d.onError.bind(d),function(){h=!0;p.dispose();n()}))};g?p.setDisposable(g.subscribe(function(){z()},d.onError.bind(onError),function(){z()})):z();return new q(p,l)})};p.timeoutWithSelector=function(l,d,f){l||(l=observableNever());f||(f=T(Error("Timeout")));var g=this;return new y(function(k){var h=new I,m=new I,n=new K;h.setDisposable(n);var p=0,z=function(d){var g=p,l=new K;m.setDisposable(l);l.setDisposable(d.subscribe(function(){p===g&&h.setDisposable(f.subscribe(k));l.dispose()},function(d){if(p===
g)k.onError(d)},function(){p===g&&h.setDisposable(f.subscribe(k))}))};z(l);var w=function(){p++;return!0};n.setDisposable(g.subscribe(function(f){if(w()){k.onNext(f);var g;try{g=d(f)}catch(l){k.onError(l);return}z(g)}},function(d){if(w())k.onError(d)},function(){if(w())k.onCompleted()}));return new q(h,m)})};p.throttleWithSelector=function(l){var d=this;return new y(function(f){var g,k=!1,h=new I,m=0,n=d.subscribe(function(d){var n;try{n=l(d)}catch(p){f.onError(p);return}k=!0;g=d;m++;var q=m,z=new K;
h.setDisposable(z);z.setDisposable(n.subscribe(function(){if(k&&m===q)f.onNext(g);k=!1;z.dispose()},f.onError.bind(f),function(){if(k&&m===q)f.onNext(g);k=!1;z.dispose()}))},function(d){h.dispose();f.onError(d);k=!1;m++},function(){h.dispose();if(k)f.onNext(g);f.onCompleted();k=!1;m++});return new q(n,h)})};p.skipLastWithTime=function(l,d){d||(d=n);var f=this;return new y(function(g){var k=[];return f.subscribe(function(f){var h=d.now();for(k.push({interval:h,value:f});0<k.length&&h-k[0].interval>=
l;)g.onNext(k.shift().value)},g.onError.bind(g),function(){for(var f=d.now();0<k.length&&f-k[0].interval>=l;)g.onNext(k.shift().value);g.onCompleted()})})};p.takeLastWithTime=function(h,d,f){return this.takeLastBufferWithTime(h,d).selectMany(function(d){return z(d,f)})};p.takeLastBufferWithTime=function(h,d){var f=this;d||(d=n);return new y(function(g){var k=[];return f.subscribe(function(f){var g=d.now();for(k.push({interval:g,value:f});0<k.length&&g-k[0].interval>=h;)k.shift()},g.onError.bind(g),
function(){for(var f=d.now(),m=[];0<k.length;){var n=k.shift();f-n.interval<=h&&m.push(n.value)}g.onNext(m);g.onCompleted()})})};p.takeWithTime=function(h,d){var f=this;d||(d=n);return new y(function(g){var k=d.scheduleWithRelative(h,function(){g.onCompleted()});return new q(k,f.subscribe(g))})};p.skipWithTime=function(h,d){var f=this;d||(d=n);return new y(function(g){var k=!1,n=d.scheduleWithRelative(h,function(){k=!0}),m=f.subscribe(function(d){if(k)g.onNext(d)},g.onError.bind(g),g.onCompleted.bind(g));
return new q(n,m)})};p.skipUntilWithTime=function(h,d){d||(d=n);var f=this;return new y(function(g){var k=!1,n=d.scheduleWithAbsolute(h,function(){k=!0}),m=f.subscribe(function(d){if(k)g.onNext(d)},g.onError.bind(g),g.onCompleted.bind(g));return new q(n,m)})};p.takeUntilWithTime=function(h,d){d||(d=n);var f=this;return new y(function(g){return new q(d.scheduleWithAbsolute(h,function(){g.onCompleted()}),f.subscribe(g))})};return w});
(function(h,p){"function"===typeof define&&define.amd?define("jsFrames",["rx.time"],function(w){return p(h,w)}):h.jsFrames=p(h,h.Rx)})(this,function(h,p){function w(h){requestAnimationFrame(w);for(var n=0;n<S.length;n++)S[n](h);E+=(h-N-E)/y;N=h}for(var F=0,H=["ms","moz","webkit","o"],M=0;M<H.length&&!h.requestAnimationFrame;++M)h.requestAnimationFrame=h[H[M]+"RequestAnimationFrame"],h.cancelAnimationFrame=h[H[M]+"CancelAnimationFrame"]||h[H[M]+"CancelRequestAnimationFrame"];h.requestAnimationFrame||
(h.requestAnimationFrame=function(p){var n=(new Date).getTime(),w=Math.max(0,16-(n-F)),y=h.setTimeout(function(){p(n+w)},w);F=n+w;return y});h.cancelAnimationFrame||(h.cancelAnimationFrame=function(h){clearTimeout(h)});(function(){var h=!1,n=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(p){function w(){!h&&this.init&&this.init.apply(this,arguments)}var q=this.prototype;h=!0;var y=new this;h=!1;for(var A in p)y[A]="function"==typeof p[A]&&"function"==typeof q[A]&&
n.test(p[A])?function(h,n){return function(){var p=this._super;this._super=q[h];var z=n.apply(this,arguments);this._super=p;return z}}(A,p[A]):p[A];w.prototype=y;w.prototype.constructor=w;w.extend=arguments.callee;return w}})();var S=[],J=[],y=20,E=0,N=0,T=p.Observable.interval(1E3).select(function(){return(1E3/E).toFixed()}).distinctUntilChanged();return{registerAnimation:function(h){S.push(h)},start:function(){requestAnimationFrame(w)},onFpsUpdate:function(h){T.subscribe(h)},Particle:Class.extend({init:function(h,
n,p){this.gravity=0.06;this.alpha=1;this.fade=0.1*Math.random();this.position={x:h.x||0,y:h.y||0};this.velocity={x:n.x||0,y:n.y||0};this.color=p;this.lastPosition={x:this.position.x,y:this.position.y}},update:function(){this.lastPosition.x=this.position.x;this.lastPosition.y=this.position.y;this.velocity.y+=this.gravity;this.position.x+=this.velocity.x;this.position.y+=this.velocity.y;this.alpha-=this.fade},render:function(h){h.save();h.globalAlpha=this.alpha;h.strokeStyle=this.color;h.beginPath();
h.moveTo(this.lastPosition.x,this.lastPosition.y);h.lineTo(this.position.x,this.position.y);h.stroke();h.restore()}}),addParticle:function(h){J.push(h)},removeParticle:function(h){J.splice(J.indexOf(h),1)},renderParticles:function(h){for(var n=J.length;n--;){var p=J[n];p.update();p.render(h)}}}});"function"===typeof define&&define.amd&&define("jsFrames.min",["jsFrames"],function(h){return h});
